from collections import defaultdict
import os 
import pandas as pd


dir_path = '../data/roomreader/room_reader_corpus_db'

sd_person_order = {'F1_Interaction_1': {'P2': 1, 'P1': 1, 'P3': 2},
 'F1_Interaction_2': {'P2': 1, 'P1': 1, 'P3': 2},
 'F2_Interaction_1': {'P4': 1, 'P5': 3},
 'F2_Interaction_2': {'P4': 1},
 'F3_Interaction_1': {'P8': 3, 'P6': 1, 'P7': 1},
 'F3_Interaction_2': {'P6': 1, 'P7': 1},
 'F4_Interaction_1': {'P14': 2,
  'P12': 1,
  'P11': 1,
  'P10': 1,
  'P9': 1,
  'P13': 3},
 'F4_Interaction_2': {'P12': 1,
  'P11': 1,
  'P10': 1,
  'P9': 1,
  'P13': 3},
 'F5_Interaction_1': {'P16': 2, 'P15': 1},
 'F5_Interaction_2': {'P16': 2, 'P15': 1},
 'F6_Interaction_1': {'P19': 3, 'P18': 1, 'P17': 1},
 'F6_Interaction_2': {'P19': 3, 'P18': 1, 'P17': 1},
 'F7_Interaction_1': {'P22': 3,
  'P20': 1,
  'P21': 1,
  'P23': 2},
 'F8_Interaction_1': {'P24': 1, 'P25': 3},
 'F8_Interaction_2': {'P24': 1, 'P25': 3},
 'F8_Interaction_3': {'P24': 1, 'P25': 3},
 'F10_Interaction_1': {'P27': 1, 'P28': 1},
 'F11_Interaction_1': {'P29': 1, 'P30': 2},
 'F11_Interaction_2': {'P29': 1, 'P30': 2},
 'F13_Interaction_1': {'P32': 1, 'P33': 2},
 'F17_Interaction_1': {'P37': 1, 'P38': 2},
 'F17_Interaction_2': {'P37': 1, 'P38': 2}}
 
 
sd_group_nums = {
 2: ['F2_Interaction_1',
  'F3_Interaction_2',
  'F5_Interaction_1',
  'F5_Interaction_2',
  'F8_Interaction_1',
  'F8_Interaction_2',
  'F8_Interaction_3',
  'F10_Interaction_1',
  'F11_Interaction_1',
  'F11_Interaction_2',
  'F13_Interaction_1',
  'F17_Interaction_1',
  'F17_Interaction_2'],
 3: ['F1_Interaction_1',
  'F1_Interaction_2',
  'F3_Interaction_1',
  'F6_Interaction_1',
  'F6_Interaction_2'],
 4: ['F7_Interaction_1'],
 5: ['F4_Interaction_2'],
 6: ['F4_Interaction_1']}

rr_group_nums = {5: ['S01', 'S02', 'S07', 'S08', 'S09', 'S10', 'S11', 'S12', 'S14', 'S17', 'S18', 'S19', 'S20', 'S21', 'S22', 'S25', 'S27', 'S28', 'S29', 'S30'], 4: [ 'S03', 'S04', 'S05', 'S15', 'S16']}
#
roomreader_desired_feats = [ ' gaze_0_x', ' gaze_0_y', ' gaze_0_z', ' gaze_1_x', ' gaze_1_y', ' gaze_1_z', ' gaze_angle_x', ' gaze_angle_y', ' pose_Tx', ' pose_Ty', ' pose_Tz', ' pose_Rx', ' pose_Ry', ' pose_Rz', ' x_1', ' x_2', ' x_3', ' x_4', ' x_5', ' x_6', ' x_7', ' x_8', ' x_9', ' x_10', ' x_11', ' x_12', ' x_13', ' x_14', ' x_15', ' x_16', ' x_17', ' x_18', ' x_19', ' x_20', ' x_21', ' x_22', ' x_23', ' x_24', ' x_25', ' x_26', ' x_27', ' x_28', ' x_29', ' x_30', ' x_31', ' x_32', ' x_33', ' x_34', ' x_35', ' x_36', ' x_37', ' x_38', ' x_39', ' x_40', ' x_41', ' x_42', ' x_43', ' x_44', ' x_45', ' x_46', ' x_47', ' x_48', ' x_49', ' x_50', ' x_51', ' x_52', ' x_53', ' x_54', ' x_55', ' x_56', ' x_57', ' x_58', ' x_59', ' x_60', ' x_61', ' x_62', ' x_63', ' x_64', ' x_65', ' x_66', ' x_67', ' y_0', ' y_1', ' y_2', ' y_3', ' y_4', ' y_5', ' y_6', ' y_7', ' y_8', ' y_9', ' y_10', ' y_11', ' y_12', ' y_13', ' y_14', ' y_15', ' y_16', ' y_17', ' y_18', ' y_19', ' y_20', ' y_21', ' y_22', ' y_23', ' y_24', ' y_25', ' y_26', ' y_27', ' y_28', ' y_29', ' y_30', ' y_31', ' y_32', ' y_33', ' y_34', ' y_35', ' y_36', ' y_37', ' y_38', ' y_39', ' y_40', ' y_41', ' y_42', ' y_43', ' y_44', ' y_45', ' y_46', ' y_47', ' y_48', ' y_49', ' y_50', ' y_51', ' y_52', ' y_53', ' y_54', ' y_55', ' y_56', ' y_57', ' y_58', ' y_59', ' y_60', ' y_61', ' y_62', ' y_63', ' y_64', ' y_65', ' y_66', ' y_67', ' AU01_r', ' AU02_r', ' AU04_r', ' AU05_r', ' AU06_r', ' AU07_r', ' AU09_r', ' AU10_r', ' AU12_r', ' AU14_r', ' AU15_r', ' AU17_r', ' AU20_r', ' AU23_r', ' AU25_r', ' AU26_r', ' AU45_r', ' AU01_c', ' AU02_c', ' AU04_c', ' AU05_c', ' AU06_c', ' AU07_c', ' AU09_c', ' AU10_c', ' AU12_c', ' AU14_c', ' AU15_c', ' AU17_c', ' AU20_c', ' AU23_c', ' AU25_c', ' AU26_c', ' AU28_c', ' AU45_c']
roomreader_raw_feats = [ ' x_1', ' x_2', ' x_3', ' x_4', ' x_5', ' x_6', ' x_7', ' x_8', ' x_9', ' x_10', ' x_11', ' x_12', ' x_13', ' x_14', ' x_15', ' x_16', ' x_17', ' x_18', ' x_19', ' x_20', ' x_21', ' x_22', ' x_23', ' x_24', ' x_25', ' x_26', ' x_27', ' x_28', ' x_29', ' x_30', ' x_31', ' x_32', ' x_33', ' x_34', ' x_35', ' x_36', ' x_37', ' x_38', ' x_39', ' x_40', ' x_41', ' x_42', ' x_43', ' x_44', ' x_45', ' x_46', ' x_47', ' x_48', ' x_49', ' x_50', ' x_51', ' x_52', ' x_53', ' x_54', ' x_55', ' x_56', ' x_57', ' x_58', ' x_59', ' x_60', ' x_61', ' x_62', ' x_63', ' x_64', ' x_65', ' x_66', ' x_67', ' y_0', ' y_1', ' y_2', ' y_3', ' y_4', ' y_5', ' y_6', ' y_7', ' y_8', ' y_9', ' y_10', ' y_11', ' y_12', ' y_13', ' y_14', ' y_15', ' y_16', ' y_17', ' y_18', ' y_19', ' y_20', ' y_21', ' y_22', ' y_23', ' y_24', ' y_25', ' y_26', ' y_27', ' y_28', ' y_29', ' y_30', ' y_31', ' y_32', ' y_33', ' y_34', ' y_35', ' y_36', ' y_37', ' y_38', ' y_39', ' y_40', ' y_41', ' y_42', ' y_43', ' y_44', ' y_45', ' y_46', ' y_47', ' y_48', ' y_49', ' y_50', ' y_51', ' y_52', ' y_53', ' y_54', ' y_55', ' y_56', ' y_57', ' y_58', ' y_59', ' y_60', ' y_61', ' y_62', ' y_63', ' y_64', ' y_65', ' y_66', ' y_67']


#excluded
#5: 'S06', S13 , S23, S24, S26
roomreader_dict=  defaultdict(list,
            {'S01': ['S01_P011_Christian_all.csv',
              'S01_P017_Julian_all.csv',
              'S01_P025_Liam_all.csv',
              'S01_P026_Oliver_all.csv',
              'S01_T002_Charlie_all.csv'],
             'S02': ['S02_P019_Liam_all.csv',
              'S02_P021_David_all.csv',
              'S02_P024_Ava_all.csv',
              'S02_P027_Mia_all.csv',
              'S02_T002_Charlie_all.csv'],
             'S03': ['S03_P013_Mila_all.csv',
              'S03_P031_Lily_all.csv',
              'S03_P041_Ava_all.csv',
              'S03_T001_Nolan_all.csv'],
             'S04': ['S04_P004_Theo_all.csv',
              'S04_P012_Olivia_all.csv',
              'S04_P016_Nolan_all.csv',
              'S04_P036_Mia_all.csv',
              'S04_T001_Daniel_all.csv'],
             'S05': ['S05_P009_Logan_all.csv',
              'S05_P039_Hazel_all.csv',
              'S05_P042_Lelani_all.csv',
              'S05_T002_Charlie_all.csv'],
            #  'S06': ['S06_P015_Harper_all.csv',
            #   'S06_P032_Aria_all.csv',
            #   'S06_P045_Max_all.csv',
            #   'S06_P056_Riley_all.csv',
            #   'S06_T002_Charlie_all.csv'],
            # S06_P045_Max_all.csv - problems (10991 vs 76255 timesteps - unaligned)
             'S07': ['S07_P003_Maya_all.csv',
              'S07_P046_Violet_all.csv',
              'S07_P051_Amelia_all.csv',
              'S07_P053_Aria_all.csv',
              'S07_T002_Charlie_all.csv'],
             'S08': ['S08_P040_Samuel_all.csv',
              'S08_P044_Adam_all.csv',
              'S08_P048_Arya_all.csv',
              'S08_P052_Charlie_all.csv',
              'S08_T001_Noah_all.csv'],
             'S09': ['S09_P007_Thomas_all.csv',
              'S09_P022_Maya_all.csv',
              'S09_P028_Carter_all.csv',
              'S09_P049_Ivy_all.csv',
              'S09_T001_William_all.csv'],
             'S10': ['S10_P047_Everly_all.csv',
              'S10_P057_Eliana_all.csv',
              'S10_P063_Lillian_all.csv',
              'S10_P068_Amelia_all.csv',
              'S10_T001_Max_all.csv'],
             'S11': ['S11_P035_aurora_all.csv',
              'S11_P043_Gina_all.csv',
              'S11_P058_Ellie_all.csv',
              'S11_P074_naomi_all.csv',
              'S11_T002_Emily_all.csv'],
             'S12': ['S12_P073_Aria_all.csv',
              'S12_P082_Charlie_all.csv',
              'S12_P084_Hazel_all.csv',
              'S12_P099_Ella_all.csv',
              'S12_T002_Sophie_all.csv'],
             'S13': ['S13_P030_David_all.csv',
              'S13_P064_Gabriel_all.csv',
              'S13_P071_Cameron_all.csv',
              'S13_P114_Nolan_all.csv',
              'S13_T001_Daniel_all.csv'],
             'S14': ['S14_P092_Claire_all.csv',
              'S14_P094_Amelia_all.csv',
              'S14_P096_Gianna_all.csv',
              'S14_P112_Emily_all.csv',
              'S14_T001_Oliver_all.csv'],
             'S15': ['S15_P091_Olivia_all.csv',
              'S15_P106_Amelia_all.csv',
              'S15_P115_Ryan_all.csv',
              'S15_T001_James_all.csv'],
             'S16': ['S16_P033_Arya_all.csv',
              'S16_P077_Nova_all.csv',
              'S16_P118_Landon_all.csv',
              'S16_T001_Alex_all.csv'],
             'S17': ['S17_P088_Evelyn_all.csv',
              'S17_P103_Sarah_all.csv',
              'S17_P116_Sophia_all.csv',
              'S17_P123_Laila_all.csv',
              'S17_T002_Abigail_all.csv'],
             'S18': ['S18_P086_Matteo_all.csv',
              'S18_P087_Naomi_all.csv',
              'S18_P090_Samuel_all.csv',
              'S18_P104_Charlie_all.csv',
              'S18_T002_Olivia_all.csv'],
             'S19': ['S19_P110_Ivy_all.csv',
              'S19_P117_James_all.csv',
              'S19_P121_evelyn_all.csv',
              'S19_P135_Samuel_all.csv',
              'S19_T002_Natalie_all.csv'],
             'S20': ['S20_P128_Leo_all.csv',
              'S20_P140_lucas_all.csv',
              'S20_P142_Connor_all.csv',
              'S20_P151_Ian_all.csv',
              'S20_T002_Luke_all.csv'],
             'S21': ['S21_P075_Oliver_all.csv',
              'S21_P124_Alison_all.csv',
              'S21_P129_Raily_all.csv',
              'S21_P146_Aaron_all.csv',
              'S21_T001_Michael_all.csv'],
             'S22': ['S22_P127_Michael_all.csv',
              'S22_P141_Thomas_all.csv',
              'S22_P147_James_all.csv',
              'S22_P154_Lucas_all.csv',
              'S22_T002_Alison_all.csv'],
             'S23': ['S23_P126_Aurora_all.csv',
              'S23_P138_Sarah_all.csv',
              'S23_P139_Oliver_all.csv',
              'S23_P158_Ethan_all.csv',
              'S23_T002_Amaya_all.csv'],
             'S24': ['S24_P109_Aria_all.csv',
              'S24_P131_liliana_all.csv',
              'S24_P144_Lilly_all.csv',
              'S24_P157_zoey_all.csv',
              'S24_T001_Jackson_all.csv'],
             'S25': ['S25_P167_Luke_all.csv',
              'S25_P169_Liam_all.csv',
              'S25_P173_Jackson_all.csv',
              'S25_P210_Gabrielle_all.csv',
              'S25_T001_Cameron_all.csv'],
             'S26': ['S26_P079_Zoe_all.csv',
              'S26_P164_Noah_all.csv',
              'S26_P170_chloe_all.csv',
              'S26_P174_Max_all.csv',
              'S26_T001_Conor_all.csv'],
             'S27': ['S27_P034_Emma_all.csv',
              'S27_P061_Owen_all.csv',
              'S27_P153_Aiden_all.csv',
              'S27_P160_Chloe_all.csv',
              'S27_T001_Jayden_all.csv'],
             'S28': ['S28_P122_Gabrielle_all.csv',
              'S28_P148_Elizabeth_all.csv',
              'S28_P175_Bella_all.csv',
              'S28_P181_Charlie_all.csv',
              'S28_T001_Claire_all.csv'],
             'S29': ['S29_P179_Michael_all.csv',
              'S29_P188_Jack_all.csv',
              'S29_P190_Nathan_all.csv',
              'S29_P208_James_all.csv',
              'S29_T002_Alison_all.csv'],
             'S30': ['S30_P186_Violet_all.csv',
              'S30_P191_Hazel_all.csv',
              'S30_P207_Michael_all.csv',
              'S30_P220_Oliver_all.csv',
              'S30_T002_Chloe_all.csv']})


rr_seconds = {'S01': 675, 'S02': 512, 'S04': 575, 'S06': 1270, 'S07': 1183, 'S08': 942, 'S09': 1852, 'S10': 1136, 'S11': 1251, 'S12': 1038, 'S13': 1276, 'S14': 1040, 'S17': 807, 'S18': 1077, 'S19': 1112, 'S20': 876, 'S21': 1045, 'S22': 1266, 'S23': 1112, 'S24': 916, 'S25': 1178, 'S26': 1045, 'S27': 763, 'S28': 1130, 'S29': 1233, 'S30': 952, 'S03': 525, 'S05': 1398, 'S15': 1105, 'S16': 1156}


rr_class_weight = [1.80282651e+02, 3.80596708e+02, 4.36352913e+01, 1.48177521e+01,
       7.13371129e+00, 2.19809863e+00, 1.59360319e-01, 9.49601359e-01,
       1.02234603e+00]

rr_4class_weight = [101.18708972,  19.5776884 ,   1.36642338,   0.31179834]

class AverageMeter(object):
    """Computes and stores the average and current value"""
    def __init__(self):
        self.reset()

    def reset(self):
        self.val = 0
        self.avg = 0
        self.sum = 0
        self.count = 0

    def update(self, val, n=1):
        self.val = val
        self.sum += val * n
        self.count += n
        self.avg = self.sum / self.count